<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Shooter Game</title>
    <script src="https://cdn.jsdelivr.net/npm/konva@8.3.6/konva.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        canvas {
            border: 1px solid #000;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <script>
        // Initialize Konva stage and layer
        const width = window.innerWidth;
        const height = window.innerHeight;
        const stage = new Konva.Stage({
            container: 'container',
            width: width,
            height: height,
        });
        const layer = new Konva.Layer();
        stage.add(layer);

        // Player setup
        const player = new Konva.Circle({
            x: width / 2,
            y: height - 30,
            fill: 'blue',
            radius: 15,
            draggable: true,
        });
        layer.add(player);
        layer.draw();

        // Score setup
        let score = 0;
        const scoreText = new Konva.Text({
            x: 10,
            y: 10,
            text: `Score: ${score}`,
            fontSize: 24,
            fill: 'white',
        });
        layer.add(scoreText);
        layer.draw();

        // Player movement
        document.addEventListener('keydown', (event) => {
            const step = 10;
            if (event.key === 'ArrowLeft') {
                player.x(Math.max(15, player.x() - step)); // Prevent going off-screen
            } else if (event.key === 'ArrowRight') {
                player.x(Math.min(width - 15, player.x() + step)); // Prevent going off-screen
            }
            layer.draw();
        });

        // Shooting
        document.addEventListener('click', (event) => {
            const bullet = new Konva.Circle({
                x: player.x(),
                y: player.y() - 20,
                fill: 'red',
                radius: 5,
            });
            layer.add(bullet);
            layer.draw();
            shootBullet(bullet);
        });

        function shootBullet(bullet) {
            const bulletAnimation = new Konva.Animation(() => {
                bullet.y(bullet.y() - 5);
                if (bullet.y() < 0) {
                    bullet.destroy(); // Remove bullet if it goes off-screen
                    layer.draw();
                } else {
                    // Check collision with enemies
                    enemies.forEach((enemy) => {
                        if (bullet.getClientRect().intersects(enemy.getClientRect())) {
                            bullet.destroy(); // Remove bullet on hit
                            enemy.destroy(); // Remove enemy on hit
                            updateScore(5); // Update score
                            layer.draw();
                        }
                    });
                }
            }, layer);
            bulletAnimation.start();
        }

        // Score update function
        function updateScore(points) {
            score += points;
            scoreText.text(`Score: ${score}`);
            layer.draw();
        }

        // Create enemies
        const enemies = [];
        function createEnemy() {
            const enemy = new Konva.Circle({
                x: Math.random() * (width - 30) + 15,
                y: 0,
                fill: 'orange',
                radius: 15,
            });
            enemies.push(enemy);
            layer.add(enemy);
            const enemyAnimation = new Konva.Animation(() => {
                enemy.y(enemy.y() + 3);
                if (enemy.y() > height) {
                    enemy.destroy(); // Remove enemy if it goes off-screen
                    enemies.splice(enemies.indexOf(enemy), 1);
                    updateScore(1); // Update score for missed enemy
                }
                if (player.getClientRect().intersects(enemy.getClientRect())) {
                    alert(`Game Over! Your final score: ${score}`);
                    window.location.reload();
                }
            }, layer);
            enemyAnimation.start();
        }

        // Start creating enemies immediately
        setInterval(createEnemy, 2000);

        // Adjust canvas size on window resize
        window.addEventListener('resize', () => {
            const newWidth = window.innerWidth;
            const newHeight = window.innerHeight;
            stage.width(newWidth);
            stage.height(newHeight);
            player.x(newWidth / 2);
            player.y(newHeight - 30);
            layer.draw();
        });
    </script>
</body>
</html>
